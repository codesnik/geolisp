в тексте правил комиссий бывают такие проверки:

check {
  includes_only(operating_carrier_iatas, 'AZ VE XM CT') and
  ( includes(city_iatas.first, 'MOW LED SVX') or
    (includes(city_iatas.first, 'IEV') and includes_only(city_iatas, 'IEV ROM MIL')) or
    (includes(city_iatas.first, 'TBS') and includes_only(city_iatas, 'TBS ROM')) or
    (includes(city_iatas.first, 'EVN') and includes_only(city_iatas, 'EVN ROM'))
  )
}

этот кусок кода на руби можно записать таким вот псевод-лиспом. просто вернуть мне такую строку, я ее сам разберу. и, скорее всего, я в базе именно ее, а не ruby, буду хранить.
"""
( И

  ( включает-только
    оперирующие-перевозчики
    (AZ VE XM CT))

  ( ИЛИ

    ( включает-один-из
      первый-город
      (MOW LED SVX))

    ( И
      ( включает-один-из
        первый-город
        (IEV))
      ( включает-только
        города
        (IEV ROM MIL)))

    ( И
      ( включает-один-из
        первый-город
        (TBS))
      ( включает-только
        города
        (TBS ROM)))

    ( И
      ( включает-один-из
        первый-город
        (EVN))
      ( включает-только
        города
        (EVN ROM)))
)
"""


операнды:

3 логические операции
И, ИЛИ (1..сколько угодно операндов)
НЕ (1 операнд)

2 списковые операции
включает-один-из
включает-только
обе принимают по два параметра-списка. В принципе, можно считать что первый список всегда "готовый", а второй задается руками.

готовые списки берутся из рекомендации:
страны
города
аэропорты
маркетинговые перевозчики
оперирующие перевозчики
номера рейсов
континенты

от каждого списка еще можно получать список из первого и последнего элемента, но чем вводить для этого дополнительную функцию, я просто нахреначу
первая-страна, первый-город, последний-маркетинговый-перевозчик, и т.п.

вводимые списки:
иата стран
иата городов
иата аэропортов
иаты перевозчиков
номера рейсов
(других не видел)
первое время можно будет без всяких комплитеров, просто строки через пробел
